import { User } from "@/types/user";

const data: User[] = [
  {
    id: "1oUvjLkEAgOB74svTBOOAwNPLtt1",
    name: "Vijay",
    email: "twadiyam@gmail.com",
    phone: "+919923624870",
    date_of_birth: "2007-07-01",
    gender: "male",
    profile_image:
      "https://soundofmeme.s3.amazonaws.com/profile-yeah3977_20250121_122114.png",
    timezone: "Asia/Kolkata",
    created_at: "2025-02-11 17:29:31",
    updated_at: "2025-02-11 17:29:31",
  },
  {
    id: "67wZvSbQnhgdG3gAU8gSxncqWXi2",
    name: "monarch shukla",
    email: "monarchshukla27@gmail.com",
    phone: "+919168202971",
    date_of_birth: "2002-02-27",
    gender: "male",
    profile_image:
      "https://soundofmeme.s3.amazonaws.com/profile-yeah3977_20250121_122114.png",
    timezone: "Asia/Kolkata",
    created_at: "2025-02-16 19:20:58",
    updated_at: "2025-02-16 19:20:58",
  },
  {
    id: "6FINihOcYidB1rfajTdoNAFnTDC3",
    name: "Adarsh Nagrikar",
    email: "adarshnagrikar1404@gmail.com",
    phone: "+917620216605",
    date_of_birth: "2007-02-01",
    gender: "male",
    profile_image:
      "https://soundofmeme.s3.amazonaws.com/profile-yeah3977_20250121_122114.png",
    timezone: "Asia/Kolkata",
    created_at: "2025-01-27 18:53:29",
    updated_at: "2025-01-27 18:53:29",
  },
  {
    id: "84yDRQYDXqPaCOZx6S0TT1nlfLA3",
    name: "Monarch Shukla",
    email: "monarchakhil27@gmail.com",
    phone: "+919168202971",
    date_of_birth: "2002-02-27",
    gender: "male",
    profile_image:
      "https://soundofmeme.s3.amazonaws.com/profile-yeah3977_20250121_122114.png",
    timezone: "Asia/Kolkata",
    created_at: "2025-02-09 16:26:32",
    updated_at: "2025-02-09 16:26:32",
  },
  {
    id: "amyuVGQfcDVPrm4D6ipcBjSnRTZ2",
    name: "Aniket Raut",
    email: "rautnaniket@gmail.com",
    phone: "+91999999999",
    date_of_birth: "2007-02-16",
    gender: "male",
    profile_image:
      "https://soundofmeme.s3.amazonaws.com/profile-yeah3977_20250121_122114.png",
    timezone: "Asia/Kolkata",
    created_at: "2025-02-03 22:52:19",
    updated_at: "2025-02-09 16:38:10",
  },
  {
    id: "f3elQL5SCKOASAjU5ex4ZyzGA7y2",
    name: "Adarsh Nagrikar",
    email: "nagrikaradarsh14@gmail.com",
    phone: "+917620216605",
    date_of_birth: "2007-02-01",
    gender: "male",
    profile_image:
      "https://soundofmeme.s3.amazonaws.com/profile-yeah3977_20250121_122114.png",
    timezone: "Asia/Kolkata",
    created_at: "2025-01-27 01:14:52",
    updated_at: "2025-01-27 01:14:52",
  },
   {
    id: "a1b2c3d4e5f6g7h8i9j0",
    name: "Sophia Patel",
    email: "sophia.patel@example.com",
    phone: "+919876543210",
    date_of_birth: "1995-06-15",
    gender: "female",
    profile_image:
      "https://randomuser.me/api/portraits/women/10.jpg",
    timezone: "Asia/Kolkata",
    created_at: "2025-01-27 10:24:32",
    updated_at: "2025-01-27 10:24:32",
  },
  {
    id: "z9y8x7w6v5u4t3s2r1q0",
    name: "Emma Sharma",
    email: "emma.sharma@example.com",
    phone: "+918765432109",
    date_of_birth: "1998-09-23",
    gender: "female",
    profile_image:
      "https://randomuser.me/api/portraits/women/11.jpg",
    timezone: "Asia/Kolkata",
    created_at: "2025-01-27 11:55:21",
    updated_at: "2025-01-27 11:55:21",
  },
  {
    id: "m1n2o3p4q5r6s7t8u9v0",
    name: "Aisha Khan",
    email: "aisha.khan@example.com",
    phone: "+917654321098",
    date_of_birth: "2001-04-08",
    gender: "female",
    profile_image:
      "https://randomuser.me/api/portraits/women/12.jpg",
    timezone: "Asia/Kolkata",
    created_at: "2025-01-27 14:10:45",
    updated_at: "2025-01-27 14:10:45",
  },
  {
    id: "x1y2z3w4v5u6t7s8r9q0",
    name: "Jordan Blake",
    email: "jordan.blake@example.com",
    phone: "+916543210987",
    date_of_birth: "1992-12-30",
    gender: "other",
    profile_image:
      "https://randomuser.me/api/portraits/lego/1.jpg",
    timezone: "Asia/Kolkata",
    created_at: "2025-01-27 15:20:38",
    updated_at: "2025-01-27 15:20:38",
  },
  {
    id: "f1g2h3j4k5l6m7n8o9p0",
    name: "Skyler Reeves",
    email: "skyler.reeves@example.com",
    phone: "+915432109876",
    date_of_birth: "1989-03-14",
    gender: "other",
    profile_image:
      "https://randomuser.me/api/portraits/lego/2.jpg",
    timezone: "Asia/Kolkata",
    created_at: "2025-01-27 16:45:19",
    updated_at: "2025-01-27 16:45:19",
  },
  {
    id: "JjAp87g4rRgmoLMj0vfsAwQAJSG3",
    name: "Monarch",
    email: "shuklama@rknec.edu",
    phone: "+919168202971",
    date_of_birth: "2007-02-06",
    gender: "male",
    profile_image:
      "https://soundofmeme.s3.amazonaws.com/profile-yeah3977_20250121_122114.png",
    timezone: "Asia/Kolkata",
    created_at: "2025-02-11 22:37:30",
    updated_at: "2025-02-11 22:37:30",
  },
  {
    id: "leGTRdglxxdqWT7Z8zYuO7896BJ2",
    name: "A1_08_Manan Daxini",
    email: "daxinimc@rknec.edu",
    phone: 8767555555,
    date_of_birth: "2005-02-02",
    gender: "male",
    profile_image:
      "https://lh3.googleusercontent.com/a/ACg8ocL501iM5ikKC2a_zZepT9jihN38WcVdCCzNiySAOmp_AFEqMA=s96-c",
    timezone: "Asia/Kolkata",
    created_at: "2025-02-03 00:06:23",
    updated_at: "2025-02-03 00:06:23",
  },
  {
    id: "oRqUReXFhSS2XHmA47x2ltxInQ93",
    name: "22_Aniket Raut",
    email: "rautan_1@rknec.edu",
    phone: 9999999999,
    date_of_birth: "2011-01-03",
    gender: "male",
    profile_image:
      "https://lh3.googleusercontent.com/a/ACg8ocIDhIezIrN2GK1qvmB1mWSmvpVkBNd_cROZG0U80n6Gt-uwlHP2=s96-c",
    timezone: "Asia/Calcutta",
    created_at: "2025-02-03 22:45:08",
    updated_at: "2025-02-03 22:45:08",
  },
  {
    id: "ptyjMT6abxRAiYOsfBduN65RLr53",
    name: "Manan Daxini",
    email: "daxinimanan@gmail.com",
    phone: "+918767877064",
    date_of_birth: "2005-02-04",
    gender: "male",
    profile_image:
      "https://soundofmeme.s3.amazonaws.com/profile-yeah3977_20250121_122114.png",
    timezone: "Asia/Kolkata",
    created_at: "2025-01-30 23:01:38",
    updated_at: "2025-01-30 23:01:38",
  },
  {
    id: "QjMvQCI2bQVEpvMMnX1Arzfa66b2",
    name: "Adarsh Nagrikar",
    email: "nagrikar1403@gmail.com",
    phone: "+911111111111",
    date_of_birth: "2007-02-01",
    gender: "male",
    profile_image:
      "https://soundofmeme.s3.amazonaws.com/profile-yeah3977_20250121_122114.png",
    timezone: "Asia/Kolkata",
    created_at: "2025-01-27 20:14:50",
    updated_at: "2025-01-27 20:14:50",
  },
  {
    id: "ukL8WgXvkLfwnbAErXsbnul59OJ2",
    name: "Random Stranger(Aniket)",
    email: "iamrandomstranger18@gmail.com",
    phone: 9999999999,
    date_of_birth: "2025-01-23",
    gender: "male",
    profile_image: "",
    timezone: "Asia/Calcutta",
    created_at: "2025-01-28 21:11:13",
    updated_at: "2025-01-28 21:11:13",
  },
  {
    id: "uqBY1dEZMogqg175CbBL8YqvbE93",
    name: "KT",
    email: "krutikatiwari15@gmail.com",
    phone: "+918669767686",
    date_of_birth: "2001-02-15",
    gender: "female",
    profile_image:
      "https://soundofmeme.s3.amazonaws.com/profile-yeah3977_20250121_122114.png",
    timezone: "Asia/Kolkata",
    created_at: "2025-02-18 13:24:51",
    updated_at: "2025-02-18 13:24:51",
  },
];

const PAGE_LIMIT: Number = 5;

const fetchUsers = async (search: string, page: Number) => {
  try {
    // Convert page to number and ensure it's minimum 1
    const currentPage = Math.max(Number(page), 1);

    // Filter users based on search value (case insensitive)
    let filteredUsers = [...data];

    if (search && search.trim() !== "") {
      const searchTerm = search.toLowerCase().trim();
      filteredUsers = data.filter(
        (user) =>
          user.name.toLowerCase().includes(searchTerm) ||
          user.email.toLowerCase().includes(searchTerm)
      );
    }

    // Calculate total pages
    const totalUsers = filteredUsers.length;
    const totalPages = Math.ceil(totalUsers / Number(PAGE_LIMIT));

    // Calculate start and end index for pagination
    const startIndex = (currentPage - 1) * Number(PAGE_LIMIT);
    const endIndex = startIndex + Number(PAGE_LIMIT);

    // Get paginated results
    const paginatedUsers = filteredUsers.slice(startIndex, endIndex);

    // Simulate API delay
    await new Promise((resolve) => setTimeout(resolve, 300));

    // Return simplified response with only currentPage, totalPages and users data
    return {
      users: paginatedUsers,
      current_page: currentPage,
      total_pages: totalPages,
      success: true,
    };
  } catch (error) {
    console.log(error);
    return {
      users: [],
      current_page: Number(page),
      total_pages: 0,
      success: false,
    };
  }
};

const createUser = async (
  name: string,
  email: string,
  phone: string | number,
  date_of_birth: string,
  gender: "male" | "female"
) => {
  try {
    // Basic validation
    if (!name || !email || !phone || !date_of_birth || !gender) {
      throw new Error("All fields are required");
    }

    // Check if email already exists
    const emailExists = data.some(
      (user) => user.email.toLowerCase() === email.toLowerCase()
    );
    if (emailExists) {
      throw new Error("Email already exists");
    }

    // Generate a random ID (simulating Firebase UID)
    const generateRandomId = () => {
      const chars =
        "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
      let result = "";
      const length = 28; // Similar to Firebase UID length
      for (let i = 0; i < length; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return result;
    };

    // Get current timestamp in YYYY-MM-DD HH:MM:SS format
    const getCurrentTimestamp = () => {
      const now = new Date();
      return now.toISOString().replace("T", " ").substring(0, 19);
    };

    // Create new user object
    const timestamp = getCurrentTimestamp();
    const newUser: User = {
      id: generateRandomId(),
      name,
      email,
      phone,
      date_of_birth,
      gender,
      profile_image:
        "https://soundofmeme.s3.amazonaws.com/profile-yeah3977_20250121_122114.png",
      timezone: "Asia/Kolkata",
      created_at: timestamp,
      updated_at: timestamp,
    };

    // Add to data array (in a real app, this would be a database insert)
    data.push(newUser);

    // Simulate API delay
    await new Promise((resolve) => setTimeout(resolve, 500));

    return {
      user: newUser,
      success: true,
      message: "User created successfully",
    };
  } catch (error) {
    const errorMessage =
      error instanceof Error ? error.message : "An unknown error occurred";
    console.error("Error creating user:", errorMessage);

    return {
      user: null,
      success: false,
      message: errorMessage,
    };
  }
};

export { fetchUsers, createUser };
